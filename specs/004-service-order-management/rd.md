# 服務單管理規格

**服務單管理**模組，使用者可以透過功能，來建立、查詢、修改寄賣單與收購單，收購單用於向客戶收購精品；寄賣單則是協助客戶將其精品寄售於店鋪中，該功能用於追蹤上述兩種服務單的狀態與細節。

## 功能1: 收購單建立

提供一個表單，讓使用者輸入收購單的相關資訊，包括客戶資料、商品資訊、收購價格等(相關欄位請參考下方表格)。

### 功能流程步驟
  
1. 使用者填寫表單中的各項欄位資訊。
2. 建立客戶或是選擇已經存在的客戶資料。(客戶可以用名字、電話號碼、Email 或是身份證字號來搜尋)
3. 提供附件上傳功能，使用者**必須**上傳**身分證明**文件
   - 或拍照上傳功能，方便使用者直接用手機拍攝並上傳身分證明文件。
4. 送出表單以建立收購單。
5. 如果是線下收購，需要把填寫的資料(商品資訊、客戶名稱、收購金額)送至後台系統，後台 API 會提供一份收購合約、一時貿易申請書給使用者進行網頁上的簽名，必須分次簽名，每次簽名結果傳回後台儲存。
6. 如果是線上收購，則在送出表單後，後端會串接Dropbox Sign API，將合約文件寄送至客戶的Email信箱，供客戶進行簽名。

### 介面設計
- 表單介面包含所有必要欄位，並有清晰的標籤與說明。
- 提供「送出」按鈕以提交表單。
- 選擇客戶時，提供搜尋功能以便快速找到既有客戶。
- 如果不存在客戶資料，提供新增客戶的選項。
- 表單欄位包含品牌名稱、款式、內碼、商品數量、金額等基本資訊。
- 表單欄位與寄賣單共用，但不包含商品配件、寄賣日期、商品瑕疵處與續約設定等欄位。
- 上傳文件功能僅能接受圖片格式，如 JPG、PNG 等。
- 提供「拍照上傳」按鈕，方便使用者直接用手機拍攝並上傳身分證明文件。
    - 預覽上傳或是拍照旁邊，有一個按鈕 &#10022; ，點擊後可以自動辨識身分證上的文字並填入客戶資料欄位的按鈕，提升使用者體驗。
    - 支援辨識台灣身分證（1 英文字母 + 9 數字）與外籍人士居留證。
    - 對於外籍人士若居留證無統一證號或未領有居留證，系統支援手動填寫格式：西元出生年月日（8位數）+ 英文姓名第一個字前兩個字母（大寫），總長度 10 位（例如：19900115JO）。
    - 如果已經選擇客戶，點擊 &#10022; 按鈕後，系統會比對身分證上的資料與已選擇的客戶資料是否一致，若不一致則跳出警告訊息，提醒使用者確認資料正確性

### 收購單的欄位

| 屬性名稱   | 型態 / 選項                                                                 | 說明                         |
| ---------- | --------------------------------------------------------------------------- | ---------------------------- |
| 服務單類型 | 下拉選單，單選：寄賣單 / 收購單                                                       | 服務單類型                   |
| 服務單來源 | 下拉選單，單選：線上 / 線下                                                           | 服務單建立來源               |
| 客戶資料   | 選擇既有客戶 / 新增客戶                                                     | 客戶基本資料（包含姓名、電話、Email、身分證字號）。身分證字號支援台灣身分證（1英文+9數字）與外籍人士格式（8位數出生年月日+2位英文字母，如：19900115JO） |
| 品牌名稱   | 文字輸入                                                                   | 品牌名稱                     |
| 款式       | 文字輸入                                                                   | 商品款式                     |
| 內碼       | 文字輸入                                                                   | 內部識別用商品代碼           |
| 商品數量   | 數字輸入                                                                   | 商品數量                     |
| 金額       | 數字輸入                                                                   | 收購或寄賣金額               |

---


## 功能2: 寄賣單建立

提供一個表單，讓使用者輸入寄賣單的相關資訊，包括客戶資料、商品資訊、寄賣價格等(相關欄位請參考下方表格)。

### 功能流程步驟

1. 使用者填寫表單中的各項欄位資訊。
2. 建立客戶或是選擇已經存在的客戶資料。(客戶可以用名字、電話號碼、Email 或是身份證字號來搜尋)
3. 提供附件上傳功能，使用者**必須**上傳**身分證明**文件
   - 或拍照上傳功能，方便使用者直接用手機拍攝並上傳身分證明文件。
4. 送出表單以建立寄賣單。
5. 如果是線下寄賣，需要把填寫的資料(商品資訊、客戶名稱、寄賣金額)送至後台系統，後台 API 會提供一份寄賣合約書，給使用者進行網頁上的簽名，每次簽名結果傳回後台儲存。
6. 如果是線上寄賣，則在送出表單後，後端會串接Dropbox Sign API，將合約文件寄送至客戶的Email信箱，供客戶進行簽名。

### 介面設計
- 表單介面包含所有必要欄位，並有清晰的標籤與說明。
- 提供「送出」按鈕以提交表單。
- 選擇客戶時，提供搜尋功能以便快速找到既有客戶。
- 如果不存在客戶資料，提供新增客戶的選項。
- 寄賣日期欄位需提供日期區間選擇器。
- 表單欄位與收購單共用，但需額外包含商品配件、寄賣日期、商品瑕疵處與續約設定等欄位。
- 上傳文件功能僅能接受圖片格式，如 JPG、PNG 等。
- 提供「拍照上傳」按鈕，方便使用者直接用手機拍攝並上傳身分證明文件。
    - 預覽上傳或是拍照旁邊，有一個按鈕 &#10022; ，點擊後可以自動辨識身分證上的文字並填入客戶資料欄位的按鈕，提升使用者體驗。
    - 支援辨識台灣身分證（1 英文字母 + 9 數字）與外籍人士居留證。
    - 對於外籍人士若居留證無統一證號或未領有居留證，系統支援手動填寫格式：西元出生年月日（8位數）+ 英文姓名第一個字前兩個字母（大寫），總長度 10 位（例如：19900115JO）。
    - 如果已經選擇客戶，點擊 &#10022; 按鈕後，系統會比對身分證上的資料與已選擇的客戶資料是否一致，若不一致則跳出警告訊息，提醒使用者確認資料正確性。

### 寄賣單的欄位

| 屬性名稱   | 型態 / 選項                                                                 | 說明                         |
| ---------- | --------------------------------------------------------------------------- | ---------------------------- |
| 服務單類型 | 單選：寄賣單 / 收購單                                                       | 服務單類型                   |
| 服務單來源 | 單選：線上 / 線下                                                           | 服務單建立來源               |
| 客戶資料   | 選擇既有客戶 / 新增客戶                                                     | 客戶基本資料（包含姓名、電話、Email、身分證字號）。身分證字號支援台灣身分證（1英文+9數字）與外籍人士格式（8位數出生年月日+2位英文字母，如：19900115JO） |
| 品牌名稱   | 文字輸入                                                                   | 品牌名稱                     |
| 款式       | 文字輸入                                                                   | 商品款式                     |
| 內碼       | 文字輸入                                                                   | 內部識別用商品代碼           |
| 商品數量   | 數字輸入                                                                   | 商品數量                     |
| 金額       | 數字輸入                                                                   | 收購或寄賣金額               |
| 商品配件   | 多選：盒子、防塵袋、購證、提袋、肩帶、羊毛氈、枕頭、保卡、鎖頭/鑰匙、緞帶/花、品牌小卡、保證書、無 | 商品隨附配件                 |
| 寄賣日期   | 日期區間                                                                   | 寄賣期間（起訖日期）         |
| 商品瑕疵處 | 多選：五金生鏽/刮痕/掉、皮質磨損/刮痕/壓痕、內裡髒污、四角磨損              | 商品瑕疵說明（寄賣用）       |
| 續約設定   | 單選：到期自動取回 / 第三個月起自動調降 10% / 屆時討論                     | 寄賣續約方式                 |

---

## 功能3: 客戶搜尋與選擇
在建立收購單或寄賣單時，使用者可以搜尋並選擇既有的客戶資料，或是新增新的客戶資料。

### 功能流程步驟
1. 在服務單建立表單中，提供一個搜尋欄位讓使用者輸入客戶的名字、電話號碼、Email 或是身份證字號。
2. 系統根據輸入的關鍵字搜尋既有的客戶資料，並顯示搜尋結果列表。
3. 使用者可以從搜尋結果中選擇一個客戶，系統會自動填入該客戶的相關資訊到服務單表單中。
4. 如果搜尋結果中沒有符合的客戶，使用者可以選擇新增客戶，系統會顯示一個新增客戶的表單，讓使用者輸入新的客戶資料。

### 介面設計
- 搜尋欄位應該明顯且易於使用，並提供清晰的指示說明。
- 搜尋結果列表應該包含客戶的基本資訊，如名字、電話號碼、Email 等，方便使用者辨識。
- 新增客戶的表單應該包含所有必要的欄位，並有清晰的標籤與說明。
- 新增客戶表單的身分證字號欄位應提供說明文字：「台灣人士請填寫身分證字號；外籍人士若居留證無統一證號或未領有居留證，請填寫：西元出生年月日(8位) + 英文姓名首字前2碼(大寫)，例：19900115JO」。
- 提供 **上傳身分證文件** 的功能，以便新增客戶時能夠附加相關證明文件。
- 提供「選擇」按鈕以便使用者從搜尋結果中選擇客戶，並將資訊填入服務單表單中。


---
## 功能4: 服務單查詢與管理
使用者可以查詢、瀏覽、修改已建立的收購單與寄賣單。
### 功能
1. 提供一個查詢介面，讓使用者可以根據不同的條件（如服務單類型、客戶名稱、日期範圍等）來搜尋服務單。
2. 顯示搜尋結果列表，包含服務單的基本資訊，如服務單編號、客戶名稱、商品資訊、金額、狀態等。
3. 使用者可以點擊某一筆服務單，進入詳細頁面查看完整資訊。
4. 在詳細頁面中，使用者可以修改服務單的相關資訊，並保存變更。
5. 提供附件管理功能，讓使用者可以查看、下載已上傳的身分證明文件、合約文件等附件。
6. 提供服務單狀態的更新功能，如標記為「已完成」、「待處理」、「已終止」等狀態選項。
7. 如果是線上簽名的服務單，可以複製合約文件的Dropbox Sign連結，或重新寄送簽名邀請給客戶。


### 介面設計
- 查詢介面應包含多種篩選條件，並有清晰的標籤與說明。
- 搜尋結果列表應該清晰易讀，並提供分頁功能以便瀏覽大量資料。
- 詳細頁面應該包含所有服務單的欄位資訊，並提供編輯功能。
- 附件管理區域應該清晰顯示已上傳的文件，並提供下載連結。
- 狀態更新功能應該易於使用，並提供明確的狀態選項。


## 權限
- 只有具有相應權限的使用者才能建立、修改或查詢服務單。
- 權限設定應該根據使用者角色進行區分，如管理員、一般使用者等。
- 系統應記錄所有服務單的建立與修改歷史，以便追蹤變更紀錄。

| 權限代號                | 說明項          |
| ------------------- | ------------ |
| serviceOrder.read        | 查詢寄賣單 |
| serviceOrder.create | 建立寄賣單       |    
| serviceOrder.delete | 刪除寄賣單       |      
| serviceOrder.update | 修改寄賣單       |   
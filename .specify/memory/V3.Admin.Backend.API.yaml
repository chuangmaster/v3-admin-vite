openapi: 3.0.3
info:
  title: V3 Admin Backend - 完整 API 規格
  description: |
    V3 管理後台 - 帳號管理、權限管理系統 API 規格
    
    ## 功能特性
    - 帳號密碼登入 (JWT Bearer Token)
    - 新增帳號、修改個人資料、變更密碼、刪除帳號
    - 查詢帳號列表 (分頁)
    - 權限管理（新增、修改、查詢、刪除權限）
    - 角色管理與權限分配
    - 稽核日誌記錄
    
    ## 身份驗證
    除了 `/api/auth/login` 端點外,所有端點都需要 JWT Bearer Token 驗證。
    在請求標頭加入: `Authorization: Bearer <token>`
    
    ## 回應格式
    所有 API 回應都遵循 `ApiResponseModel<T>` 格式:
    - `success`: 操作是否成功 (boolean)
    - `code`: 業務邏輯代碼 (string)
    - `message`: 繁體中文訊息 (string)
    - `data`: 回應資料 (T, 可為 null)
    - `timestamp`: 回應時間戳 (ISO 8601)
    - `traceId`: 分散式追蹤 ID (string)
    
  version: 1.0.0
  contact:
    name: V3 Admin Backend Team
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.v3admin.example.com
    description: 生產環境
  - url: https://staging-api.v3admin.example.com
    description: 測試環境
  - url: http://localhost:5173
    description: 本機開發環境

tags:
  - name: Authentication
    description: 身份驗證相關端點
  - name: Accounts
    description: 帳號管理相關端點
  - name: Permissions
    description: 權限管理操作

paths:
  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: 使用者登入
      description: |
        使用帳號密碼進行身份驗證,成功後回傳 JWT Token。
        Token 有效期為 1 小時,支援多裝置同時登入。
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              validLogin:
                summary: 有效的登入請求
                value:
                  username: admin
                  password: Admin@123
      responses:
        '200':
          description: 登入成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LoginResponse'
              examples:
                success:
                  summary: 登入成功
                  value:
                    success: true
                    code: SUCCESS
                    message: 登入成功
                    data:
                      token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      expiresAt: '2025-10-26T15:30:00Z'
                      user:
                        id: 00000000-0000-0000-0000-000000000001
                        username: admin
                        displayName: 系統管理員
                        createdAt: '2025-10-26T08:00:00Z'
                        updatedAt: null
                    timestamp: '2025-10-26T14:30:00Z'
                    traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b
        '400':
          description: 驗證錯誤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                validationError:
                  summary: 輸入驗證錯誤
                  value:
                    success: false
                    code: VALIDATION_ERROR
                    message: 帳號或密碼不符合格式要求
                    data: null
                    timestamp: '2025-10-26T14:30:00Z'
                    traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b
        '401':
          description: 登入失敗
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                invalidCredentials:
                  summary: 帳號或密碼錯誤
                  value:
                    success: false
                    code: INVALID_CREDENTIALS
                    message: 帳號或密碼錯誤
                    data: null
                    timestamp: '2025-10-26T14:30:00Z'
                    traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b
        '500':
          $ref: '#/components/responses/InternalError'

  /api/accounts:
    get:
      tags:
        - Accounts
      summary: 查詢帳號列表
      description: |
        查詢所有有效 (未刪除) 的帳號列表,支援分頁。
        需要 JWT 身份驗證。
      operationId: listAccounts
      security:
        - bearerAuth: []
      parameters:
        - name: pageNumber
          in: query
          description: 頁碼 (從 1 開始)
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          description: 每頁數量
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: 查詢成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AccountListResponse'
              examples:
                success:
                  summary: 查詢成功
                  value:
                    success: true
                    code: SUCCESS
                    message: 查詢成功
                    data:
                      items:
                        - id: 00000000-0000-0000-0000-000000000001
                          username: admin
                          displayName: 系統管理員
                          createdAt: '2025-10-26T08:00:00Z'
                          updatedAt: null
                        - id: 00000000-0000-0000-0000-000000000002
                          username: user1
                          displayName: 一般使用者
                          createdAt: '2025-10-26T09:00:00Z'
                          updatedAt: null
                      totalCount: 2
                      pageNumber: 1
                      pageSize: 10
                      totalPages: 1
                    timestamp: '2025-10-26T14:30:00Z'
                    traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    
    post:
      tags:
        - Accounts
      summary: 新增帳號
      description: |
        建立新的使用者帳號。
        帳號名稱必須唯一,僅允許英數字與底線。
        密碼最少 8 字元,支援所有 Unicode 字元。
        需要 JWT 身份驗證。
      operationId: createAccount
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccountRequest'
            examples:
              validRequest:
                summary: 有效的新增請求
                value:
                  username: newuser
                  password: SecureP@ss123
                  displayName: 新使用者
      responses:
        '201':
          description: 帳號建立成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AccountResponse'
              examples:
                success:
                  summary: 建立成功
                  value:
                    success: true
                    code: CREATED
                    message: 帳號建立成功
                    data:
                      id: 00000000-0000-0000-0000-000000000003
                      username: newuser
                      displayName: 新使用者
                      createdAt: '2025-10-26T14:30:00Z'
                      updatedAt: null
                    timestamp: '2025-10-26T14:30:00Z'
                    traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b
        '400':
          description: 驗證錯誤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                validationError:
                  summary: 輸入驗證錯誤
                  value:
                    success: false
                    code: VALIDATION_ERROR
                    message: 帳號或密碼格式不正確
                    data: null
                    timestamp: '2025-10-26T14:30:00Z'
                    traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          description: 業務邏輯錯誤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                usernameExists:
                  summary: 帳號已存在
                  value:
                    success: false
                    code: USERNAME_EXISTS
                    message: 帳號已存在
                    data: null
                    timestamp: '2025-10-26T14:30:00Z'
                    traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b
        '500':
          $ref: '#/components/responses/InternalError'

  /api/accounts/{id}:
    get:
      tags:
        - Accounts
      summary: 查詢帳號詳細資訊
      description: |
        根據帳號 ID 查詢詳細資訊。
        需要 JWT 身份驗證。
      operationId: getAccount
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: 帳號 ID (GUID)
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: 查詢成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AccountResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 帳號不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                notFound:
                  summary: 帳號不存在
                  value:
                    success: false
                    code: NOT_FOUND
                    message: 帳號不存在
                    data: null
                    timestamp: '2025-10-26T14:30:00Z'
                    traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b
        '500':
          $ref: '#/components/responses/InternalError'
    
    put:
      tags:
        - Accounts
      summary: 更新帳號資訊
      description: |
        更新指定帳號的顯示名稱。
        使用者只能更新自己的資訊。
        需要 JWT 身份驗證。
      operationId: updateAccount
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: 帳號 ID (GUID)
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAccountRequest'
            examples:
              validRequest:
                summary: 有效的更新請求
                value:
                  displayName: 新的顯示名稱
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AccountResponse'
        '400':
          description: 驗證錯誤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: 禁止操作
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                forbidden:
                  summary: 只能更新自己的資訊
                  value:
                    success: false
                    code: FORBIDDEN
                    message: 您無權執行此操作
                    data: null
        '404':
          description: 帳號不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '409':
          description: 並發衝突
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                conflict:
                  summary: 並發更新衝突
                  value:
                    success: false
                    code: CONCURRENT_UPDATE_CONFLICT
                    message: 資料已被其他使用者更新，請重新載入後再試
        '500':
          $ref: '#/components/responses/InternalError'
    
    delete:
      tags:
        - Accounts
      summary: 刪除帳號
      description: |
        軟刪除指定帳號 (標記為已刪除但保留資料)。
        不可刪除當前登入的帳號。
        不可刪除最後一個有效帳號。
        需要 JWT 身份驗證與確認訊息。
      operationId: deleteAccount
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: 帳號 ID (GUID)
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteAccountRequest'
            examples:
              validRequest:
                summary: 有效的刪除請求
                value:
                  confirmation: CONFIRM
      responses:
        '200':
          description: 刪除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  summary: 刪除成功
                  value:
                    success: true
                    code: SUCCESS
                    message: 帳號刪除成功
                    data: null
        '400':
          description: 驗證錯誤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: 禁止操作
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                cannotDeleteSelf:
                  summary: 無法刪除當前帳號
                  value:
                    success: false
                    code: CANNOT_DELETE_SELF
                    message: 無法刪除當前登入帳號
                    data: null
        '404':
          description: 帳號不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '422':
          description: 業務邏輯錯誤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                lastAccount:
                  summary: 無法刪除最後一個帳號
                  value:
                    success: false
                    code: LAST_ACCOUNT_CANNOT_DELETE
                    message: 無法刪除最後一個帳號
                    data: null
        '500':
          $ref: '#/components/responses/InternalError'

  /api/accounts/{id}/password:
    put:
      tags:
        - Accounts
      summary: 變更密碼
      description: |
        變更指定帳號的密碼。
        使用者只能變更自己的密碼。
        必須驗證舊密碼正確。
        新密碼不可與舊密碼相同。
        需要 JWT 身份驗證。
      operationId: changePassword
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: 帳號 ID (GUID)
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
            examples:
              validRequest:
                summary: 有效的變更密碼請求
                value:
                  oldPassword: OldP@ss123
                  newPassword: NewSecureP@ss456
      responses:
        '200':
          description: 密碼變更成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  summary: 變更成功
                  value:
                    success: true
                    code: SUCCESS
                    message: 密碼變更成功
                    data: null
        '400':
          description: 驗證錯誤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                validationError:
                  summary: 新密碼與舊密碼相同
                  value:
                    success: false
                    code: VALIDATION_ERROR
                    message: 新密碼與舊密碼相同
                    data: null
        '401':
          description: 舊密碼錯誤或未授權
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                invalidOldPassword:
                  summary: 舊密碼錯誤
                  value:
                    success: false
                    code: INVALID_CREDENTIALS
                    message: 舊密碼錯誤
                    data: null
        '403':
          description: 禁止操作
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                forbidden:
                  summary: 只能變更自己的密碼
                  value:
                    success: false
                    code: FORBIDDEN
                    message: 您無權執行此操作
                    data: null
        '404':
          description: 帳號不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '422':
          description: 業務邏輯錯誤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                passwordSameAsOld:
                  summary: 新密碼與舊密碼相同
                  value:
                    success: false
                    code: PASSWORD_SAME_AS_OLD
                    message: 新密碼與舊密碼相同
                    data: null
        '500':
          $ref: '#/components/responses/InternalError'

  /api/permissions:
    get:
      tags:
        - Permissions
      summary: 查詢權限列表
      description: 取得所有權限清單，支援分頁和篩選
      operationId: getPermissions
      security:
        - bearerAuth: []
      parameters:
        - name: pageNumber
          in: query
          description: 頁碼（從 1 開始）
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          description: 每頁筆數
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: permissionType
          in: query
          description: 權限類型篩選（route 或 function）
          schema:
            type: string
            enum: [route, function]
        - name: searchKeyword
          in: query
          description: 搜尋關鍵字（搜尋權限代碼或名稱）
          schema:
            type: string
      responses:
        '200':
          description: 成功取得權限列表
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PermissionListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - bearerAuth: []

    post:
      tags:
        - Permissions
      summary: 建立權限
      description: 新增一個權限定義
      operationId: createPermission
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePermissionRequest'
      responses:
        '201':
          description: 權限建立成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PermissionDto'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          description: 權限代碼已存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: false
                code: "DUPLICATE_PERMISSION_CODE"
                message: "權限代碼已存在"
                timestamp: "2025-11-05T10:30:00Z"
                traceId: "abc123"
        '500':
          $ref: '#/components/responses/InternalError'

  /api/permissions/{id}:
    get:
      tags:
        - Permissions
      summary: 查詢單一權限
      description: 根據 ID 取得權限詳細資訊
      operationId: getPermissionById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 權限 ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: 成功取得權限
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PermissionDto'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 權限不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: false
                code: "PERMISSION_NOT_FOUND"
                message: "權限不存在"
                timestamp: "2025-11-05T10:30:00Z"
                traceId: "abc123"
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      tags:
        - Permissions
      summary: 更新權限
      description: 更新權限的名稱或描述
      operationId: updatePermission
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 權限 ID (UUID)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePermissionRequest'
      responses:
        '200':
          description: 權限更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PermissionDto'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 權限不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '409':
          description: 併發更新衝突
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: false
                code: "CONCURRENT_UPDATE_CONFLICT"
                message: "資料已被其他使用者更新，請重新載入後再試"
                timestamp: "2025-11-05T10:30:00Z"
                traceId: "abc123"
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      tags:
        - Permissions
      summary: 刪除權限
      description: 刪除一個權限（軟刪除）
      operationId: deletePermission
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 權限 ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: 權限刪除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 權限不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '422':
          description: 權限正被角色使用，無法刪除
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: false
                code: "PERMISSION_IN_USE"
                message: "該權限正被角色使用，無法刪除"
                timestamp: "2025-11-05T10:30:00Z"
                traceId: "abc123"
        '500':
          $ref: '#/components/responses/InternalError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        使用 JWT Bearer Token 進行身份驗證。
        在 Authorization 標頭加入: `Bearer <token>`
        
        Token 透過 `/api/auth/login` 端點取得,有效期為 1 小時。

  schemas:
    ApiResponse:
      type: object
      required:
        - success
        - code
        - message
        - timestamp
        - traceId
      properties:
        success:
          type: boolean
          description: 操作是否成功
          example: true
        code:
          type: string
          description: 業務邏輯代碼
          example: SUCCESS
        message:
          type: string
          description: 繁體中文訊息
          example: 操作成功
        data:
          type: object
          description: 回應資料 (可為 null)
          nullable: true
        timestamp:
          type: string
          format: date-time
          description: 回應時間戳記 (ISO 8601, UTC)
          example: '2025-10-26T14:30:00Z'
        traceId:
          type: string
          format: uuid
          description: 分散式追蹤 ID
          example: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b

    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 20
          description: 帳號名稱
          example: admin
        password:
          type: string
          minLength: 8
          description: 密碼
          format: password
          example: Admin@123

    LoginResponse:
      type: object
      required:
        - token
        - expiresAt
        - user
      properties:
        token:
          type: string
          description: JWT Access Token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        expiresAt:
          type: string
          format: date-time
          description: Token 過期時間 (ISO 8601, UTC)
          example: '2025-10-26T15:30:00Z'
        user:
          $ref: '#/components/schemas/AccountResponse'

    CreateAccountRequest:
      type: object
      required:
        - username
        - password
        - displayName
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 20
          pattern: '^[a-zA-Z0-9_]+$'
          description: 帳號名稱 (僅英數字與底線)
          example: newuser
        password:
          type: string
          minLength: 8
          description: 密碼 (支援所有 Unicode 字元)
          format: password
          example: SecureP@ss123
        displayName:
          type: string
          minLength: 1
          maxLength: 100
          description: 顯示名稱
          example: 新使用者

    UpdateAccountRequest:
      type: object
      required:
        - displayName
      properties:
        displayName:
          type: string
          minLength: 1
          maxLength: 100
          description: 顯示名稱
          example: 新的顯示名稱

    ChangePasswordRequest:
      type: object
      required:
        - oldPassword
        - newPassword
      properties:
        oldPassword:
          type: string
          minLength: 8
          description: 舊密碼
          format: password
          example: OldP@ss123
        newPassword:
          type: string
          minLength: 8
          description: 新密碼 (不可與舊密碼相同)
          format: password
          example: NewSecureP@ss456

    DeleteAccountRequest:
      type: object
      required:
        - confirmation
      properties:
        confirmation:
          type: string
          enum:
            - CONFIRM
          description: 確認訊息 (必須為 "CONFIRM")
          example: CONFIRM

    AccountResponse:
      type: object
      required:
        - id
        - username
        - displayName
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          description: 使用者 ID
          example: 00000000-0000-0000-0000-000000000001
        username:
          type: string
          description: 帳號名稱
          example: admin
        displayName:
          type: string
          description: 顯示名稱
          example: 系統管理員
        createdAt:
          type: string
          format: date-time
          description: 建立時間 (ISO 8601, UTC)
          example: '2025-10-26T08:00:00Z'
        updatedAt:
          type: string
          format: date-time
          description: 最後更新時間 (ISO 8601, UTC)
          nullable: true
          example: null

    AccountListResponse:
      type: object
      required:
        - items
        - totalCount
        - pageNumber
        - pageSize
        - totalPages
      properties:
        items:
          type: array
          description: 帳號清單
          items:
            $ref: '#/components/schemas/AccountResponse'
        totalCount:
          type: integer
          description: 總數量
          example: 2
        pageNumber:
          type: integer
          minimum: 1
          description: 當前頁碼 (從 1 開始)
          example: 1
        pageSize:
          type: integer
          minimum: 1
          maximum: 100
          description: 每頁數量
          example: 10
        totalPages:
          type: integer
          minimum: 0
          description: 總頁數
          example: 1

    CreatePermissionRequest:
      type: object
      required:
        - permissionCode
        - name
        - permissionType
      properties:
        permissionCode:
          type: string
          maxLength: 100
          description: 權限代碼（功能權限格式為 resource.action，如 inventory.create）
          example: "inventory.create"
        name:
          type: string
          maxLength: 200
          description: 權限名稱
          example: "新增庫存"
        description:
          type: string
          description: 權限描述
          example: "允許新增庫存項目"
        permissionType:
          type: string
          enum: [route, function]
          description: 權限類型（route: 路由權限, function: 功能權限）
          example: "function"
        routePath:
          type: string
          maxLength: 500
          description: 路由路徑（僅路由權限需要，如 /inventory）
          example: "/inventory"

    UpdatePermissionRequest:
      type: object
      required:
        - name
        - version
      properties:
        name:
          type: string
          maxLength: 200
          description: 權限名稱
          example: "新增庫存（更新）"
        description:
          type: string
          description: 權限描述
          example: "允許新增庫存項目（更新後）"
        version:
          type: integer
          minimum: 1
          description: 版本號（樂觀並發控制）
          example: 1

    PermissionDto:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: 權限 ID
        permissionCode:
          type: string
          description: 權限代碼
        name:
          type: string
          description: 權限名稱
        description:
          type: string
          nullable: true
          description: 權限描述
        permissionType:
          type: string
          enum: [route, function]
          description: 權限類型
        routePath:
          type: string
          nullable: true
          description: 路由路徑
        createdAt:
          type: string
          format: date-time
          description: 建立時間
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: 最後更新時間
        version:
          type: integer
          description: 版本號

    PermissionListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PermissionDto'
        totalCount:
          type: integer
          description: 總筆數
        pageNumber:
          type: integer
          description: 當前頁碼
        pageSize:
          type: integer
          description: 每頁筆數

  responses:
    Unauthorized:
      description: 未授權 - 缺少或無效的 JWT Token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            success: false
            code: UNAUTHORIZED
            message: 未授權,請先登入
            data: null
            timestamp: '2025-10-26T14:30:00Z'
            traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b

    ValidationError:
      description: 輸入驗證失敗
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            success: false
            code: "VALIDATION_ERROR"
            message: "權限代碼格式錯誤，必須為 resource.action 格式（如 inventory.create）"
            timestamp: "2025-11-05T10:30:00Z"
            traceId: "abc123"

    InternalError:
      description: 系統內部錯誤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            success: false
            code: INTERNAL_ERROR
            message: 系統內部錯誤，請稍後再試
            data: null
            timestamp: '2025-10-26T14:30:00Z'
            traceId: 7d3e5f8a-2b4c-4d9e-8f7a-1c2d3e4f5a6b
